(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{10:function(e,t,n){e.exports=n(21)},15:function(e,t,n){},17:function(e,t,n){},19:function(e,t,n){},21:function(e,t,n){"use strict";n.r(t);var i=n(0),a=n.n(i),o=n(8),s=n.n(o),r=(n(15),n(2)),c=n(3),l=n(5),h=n(4),u=n(6),d=n(1),g=(n(17),n(9)),f=n.n(g),v=(n(19),function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(l.a)(this,Object(h.a)(t).call(this,e))).handlePollIntervalChange=n.handlePollIntervalChange.bind(Object(d.a)(Object(d.a)(n))),n.handleMaxDistanceChange=n.handleMaxDistanceChange.bind(Object(d.a)(Object(d.a)(n))),n}return Object(u.a)(t,e),Object(c.a)(t,[{key:"render",value:function(){var e=this.props,t=e.pollInterval,n=void 0===t?60:t,i=e.maxDistance,o=void 0===i?500:i;return a.a.createElement("form",{className:"settings"},"Check every ",a.a.createElement("input",{id:"pollInterval",name:"pollInterval",type:"number",value:n,onChange:this.handlePollIntervalChange,min:15,step:15})," seconds",a.a.createElement("br",null),"Notify when Blinkee within ",a.a.createElement("input",{id:"maxDistance",name:"maxDistance",type:"number",value:o,onChange:this.handleMaxDistanceChange,min:100,step:100})," meters")}},{key:"handlePollIntervalChange",value:function(e){var t=parseInt(e.target.value,10);return this.props.onChange({pollInterval:t})}},{key:"handleMaxDistanceChange",value:function(e){var t=parseInt(e.target.value,10);return this.props.onChange({maxDistance:t})}}]),t}(i.Component)),m=function(e,t){return e.distance<t.distance?-1:t.distance<e.distance?1:0},p=function(e){function t(e){var n;return Object(r.a)(this,t),(n=Object(l.a)(this,Object(h.a)(t).call(this,e))).state={active:!1,settings:JSON.parse(localStorage.getItem("settings"))||{pollInterval:60,maxDistance:500}},n.handleToggle=n.handleToggle.bind(Object(d.a)(Object(d.a)(n))),n.handleSettingsChange=n.handleSettingsChange.bind(Object(d.a)(Object(d.a)(n))),n.setStatePromise=n.setStatePromise.bind(Object(d.a)(Object(d.a)(n))),n}return Object(u.a)(t,e),Object(c.a)(t,[{key:"setStatePromise",value:function(e){var t=this;return new Promise(function(n){t.setState(e,function(){n()})})}},{key:"render",value:function(){var e=this.state,t=e.active,n=e.settings,i=e.scooters,o="icon fas fa-toggle-".concat(t?"on":"off"),s=t?"on":"off";return a.a.createElement("div",null,a.a.createElement("div",{className:"toggle",onClick:this.handleToggle},a.a.createElement("i",{className:o})," ",s),a.a.createElement(v,Object.assign({},n,{onChange:this.handleSettingsChange})),a.a.createElement("footer",null,i&&a.a.createElement("div",null,i.length," blinkees available")))}},{key:"handleToggle",value:function(){var e=this,t=!this.state.active;return this.setStatePromise({active:t}).then(function(){return t?e.requestPermission("Notification").then(function(){return e.startPolling()}):e.stopPolling()})}},{key:"handleSettingsChange",value:function(e){var t=this;return this.setStatePromise({settings:Object.assign({},this.state.settings,e)}).then(function(){window.localStorage.setItem("settings",JSON.stringify(t.state.settings))}).then(function(){t.handleDataChange()}),Promise.resolve()}},{key:"requestPermission",value:function(e){if(!(e in window))return Promise.reject();var t=window[e];return"denied"===t.permission?Promise.reject():"granted"===t.permission?Promise.resolve():t.requestPermission()}},{key:"startPolling",value:function(){var e=this,t=this.state.settings.pollInterval;return t&&(this.fetchBlinkee().then(function(){return e.handleDataChange()}),this.poller=setInterval(function(){e.fetchBlinkee().then(function(){return e.handleDataChange()})},1e3*t)),this.locationWatch=navigator.geolocation.watchPosition(function(t){var n=t.coords;e.setStatePromise({location:n}).then(function(){return e.handleDataChange()})}),Promise.resolve()}},{key:"stopPolling",value:function(){return clearInterval(this.poller),delete this.poller,navigator.geolocation.clearWatch(this.locationWatch),delete this.locationWatch,delete this.closest,this.setStatePromise({scooters:void 0,location:void 0})}},{key:"fetchBlinkee",value:function(){return fetch("https://blinkee.city/api/regions/11/vehicles").then(function(e){return e.json()}).then(function(e){return{scooters:e.data.items.filter(function(e){return"scooter"===e.type}).map(function(e){return{id:e.id,position:e.position}})}}).then(this.setStatePromise)}},{key:"handleDataChange",value:function(){var e=this.state,t=e.location,n=(t=void 0===t?{}:t).latitude,i=t.longitude,a=e.scooters,o=void 0===a?[]:a,s=e.settings.maxDistance;if(s&&n&&i){var r=o.map(function(e){return Object.assign({},e,{distance:1e3*f()(n,i,e.position.lat,e.position.lng)})}).sort(m);if(r.length>0){var c=r[0];c.distance<s&&(!this.closest||c.distance<this.closest.distance&&c.id!==this.closest.id)&&(this.closest=c,this.notifyUser())}}}},{key:"notifyUser",value:function(){if("granted"===Notification.permission){var e=Math.ceil(this.closest.distance);this.notification=new Notification("blinkee close by!",{icon:"favicon.png",body:"Blinkee parked at ".concat(e+""," meters.")}),this.notification.onclick=function(e){e.preventDefault()}}}}]),t}(i.Component),b=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function w(e,t){navigator.serviceWorker.register(e).then(function(e){e.onupdatefound=function(){var n=e.installing;n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See http://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))}}}).catch(function(e){console.error("Error during service worker registration:",e)})}s.a.render(a.a.createElement(p,null),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/blinkee",window.location).origin!==window.location.origin)return;window.addEventListener("load",function(){var t="".concat("/blinkee","/service-worker.js");b?(function(e,t){fetch(e).then(function(n){404===n.status||-1===n.headers.get("content-type").indexOf("javascript")?navigator.serviceWorker.ready.then(function(e){e.unregister().then(function(){window.location.reload()})}):w(e,t)}).catch(function(){console.log("No internet connection found. App is running in offline mode.")})}(t,e),navigator.serviceWorker.ready.then(function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit http://bit.ly/CRA-PWA")})):w(t,e)})}}()}},[[10,2,1]]]);
//# sourceMappingURL=main.b0e4d26d.chunk.js.map